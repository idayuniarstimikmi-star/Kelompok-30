<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vinix 7 ‚Äî Asisten Digital (Final)</title> 
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* SKEMA WARNA BARU */
        :root{
            --bg:#FFFFFF; /* Latar Belakang Putih */
            --card-bg:#F8F9FA; /* Background Card sedikit off-white */
            --text-main:#333333; /* Warna Teks Utama Hitam/Abu-abu Gelap */
            --primary:#FFC300; /* Kuning Keemasan/Emas untuk Aksen */
            --accent:#1E5EAE; /* Biru Logo untuk Aksen Sekunder */
            --muted:#6c757d; /* Warna Teks Muted */
            --delete-red: #dc3545; /* Warna untuk tombol Hapus */
        }
        *{box-sizing:border-box}
        body{
            font-family:'Poppins',sans-serif;
            margin:0;
            background:var(--bg);
            color:var(--text-main);
        }
        .container{max-width:1100px;margin:32px auto;padding:24px}
        header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
        .brand{display:flex;gap:12px;align-items:center}
        
        /* LOGO CSS */
        .logo-img{
            width: 180px; 
            height: auto;
            margin-right: 0; 
        }
        .logo-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
        }

        h1{font-size:20px;margin:0}
        nav{display:flex;gap:8px}
        /* Tombol Tab */
        .tab{
            background:transparent;
            border:1px solid var(--muted); 
            padding:8px 14px;
            border-radius:10px;
            cursor:pointer;
            color:var(--muted);
            transition: all 0.2s;
        }
        .tab.active{
            background:var(--accent); 
            border:1px solid var(--accent);
            color:white; 
        }
        
        /* Gaya Card & Grid */
        .card{
            background:var(--card-bg);
            border-radius:12px;
            padding:18px;
            margin-top:12px;
            border: 1px solid #dee2e6;
            box-shadow: 0 0 10px rgba(30, 94, 174, 0.1), 
                        0 4px 12px rgba(0,0,0,0.05); 
        }
        .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
        .full{grid-column:1/-1}
        .muted{color:var(--muted);font-size:13px}

        /* Input & Button */
        .row{display:flex;gap:8px}
        input,select,textarea{
            width:100%;
            padding:10px;
            border-radius:8px;
            border:1px solid var(--muted);
            background:white;
            color:var(--text-main);
        }
        button{padding:10px 12px;border-radius:10px;border:0;cursor:pointer}
        .btn-primary{background:var(--primary);color:var(--text-main)}
        .btn-ghost{background:transparent;border:1px solid var(--muted);color:var(--text-main)}
        .btn-ghost.reply-btn { /* Gaya tombol balas agar lebih kecil */
            padding: 4px 8px; 
            font-size: 11px;
            height: fit-content;
        }
        .btn-delete {
            background: transparent;
            border: 1px solid var(--delete-red);
            color: var(--delete-red);
            padding: 4px 8px;
            font-size: 11px;
            height: fit-content;
        }

        /* PROGRESS BAR & PATH DATA (Link and Match) */
        .progress-bar-container {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin-top: 5px;
        }
        .progress-bar {
            height: 100%;
            background: var(--accent);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        /* Gaya untuk Data Industri yang Diintegrasikan */
        .skill-data {
            margin-top: 10px;
            padding: 8px;
            background: #e9f5ff; 
            border-left: 3px solid var(--accent);
            border-radius: 4px;
            font-size: 14px;
            color: var(--text-main);
        }
        /* END PROGRESS BAR & PATH DATA */

        /* Resume & Community */
        .resume-preview{background:#F4F4F4;padding:12px;border-radius:8px;border:1px solid #dee2e6;min-height:220px}
        .messages{max-height:320px;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
        .msg{
            background:white;
            border:1px solid #e9ecef;
            padding:10px;
            border-radius:8px;
            position: relative; /* Penting untuk penempatan stiker modal */
        }
        .msg-reply-indicator {
            padding: 4px 8px;
            margin-bottom: 5px;
            background: #f1f1f1;
            border-left: 3px solid var(--primary);
            border-radius: 4px;
            font-style: italic;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .new-link-btn{
            display: block;
            text-align: center;
            margin-top: 15px;
            padding: 12px;
            background: var(--accent);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: background 0.2s;
        }
        .new-link-btn:hover {
            background: #15488c; 
        }

        /* GAYA BARU: Tombol Stiker Pemicu */
        .reaction-trigger-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px 6px;
            margin-left: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .reaction-trigger-btn:hover {
            background: #e9ecef;
        }
        .reactions-display {
            font-size: 16px;
            margin-top: 8px;
            border-top: 1px solid #eee;
            padding-top: 5px;
            display: flex;
            gap: 8px;
        }
        .reaction-count {
            cursor: pointer;
            background: #f1f1f1;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 12px;
        }


        /* GAYA BARU: Modal Stiker/Dropdown (Diperluas untuk banyak icon) */
        .sticker-modal {
            position: absolute; 
            bottom: 30px; 
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000; 
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            width: 250px; /* Lebar diperluas agar banyak ikon muat */
        }
        .modal-sticker {
            cursor: pointer;
            font-size: 24px;
            transition: transform 0.1s;
        }
        .modal-sticker:hover {
            transform: scale(1.15);
        }

        footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

        @media(max-width:900px){.grid{grid-template-columns:1fr}.brand h1{font-size:16px}
            .logo-img{width:150px;height:auto;margin-right:0;}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="brand">
                <img class="logo-img" src="img/logo vinix asisten.png" onerror="this.style.display='none'; document.getElementById('logo-text').style.display='block';" alt="Vinix Asisten Logo"> 
                <div class="logo-text" id="logo-text" style="display:none;">VINIX 7</div>
                <div>
                    <h1>Asisten Digital</h1> 
                    <div class="muted">Selamat Datang</div>
                </div>
            </div>
            <nav>
                <button class="tab active" data-tab="finance">Finance Zone</button>
                <button class="tab" data-tab="career">Career Zone</button>
                <button class="tab" data-tab="mental">Mental Zone</button>
            </nav>
        </header>

        <section id="finance" class="card">
            <div class="grid">
                <div>
                    <h2>Smart Budgeting (Visualisasi Data Sederhana)</h2>
                    <p class="muted">Masukkan pemasukan dan kategori pengeluaran ‚Äî Vinix akan bantu bikin rekomendasi anggaran sederhana.</p>

                    <div style="margin-top:12px" class="card">
                        <label>Penghasilan Bulanan (Rp)</label>
                        <input id="income" type="number" value="5000000" />
                        <div class="row" style="margin-top:8px">
                            <div style="flex:1">
                                <label>Pengeluaran Tetap (Rp)</label>
                                <input id="fixed" type="number" value="2000000" />
                            </div>
                            <div style="width:140px">
                                <label>Simpanan Target (%)</label>
                                <input id="savePct" type="number" value="20" />
                            </div>
                        </div>
                        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
                            <button class="btn-primary" id="calcBudget">Hitung Rekomendasi</button>
                            <button class="btn-ghost" id="resetBudget">Reset</button>
                        </div>

                        <div id="budgetResult" style="margin-top:14px"></div>
                        
                        <div id="distributionGraph" style="margin-top:20px;">
                            <h4 style="margin-bottom:10px; font-size:16px;">Distribusi Budget Bulanan</h4>
                            <div id="barContainer" style="display: flex; height: 30px; border-radius: 5px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                <div id="fixedBar" style="background-color: #007bff; text-align: center; color: white; font-size: 12px; line-height: 30px; transition: width 0.5s;"></div>
                                <div id="saveBar" style="background-color: #28a745; text-align: center; color: white; font-size: 12px; line-height: 30px; transition: width 0.5s;"></div>
                                <div id="variableBar" style="background-color: var(--primary); text-align: center; color: var(--text-main); font-size: 12px; line-height: 30px; transition: width 0.5s;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px;">
                                <span><span style="color:#007bff; font-weight: bold;">‚ñ†</span> Tetap</span>
                                <span><span style="color:#28a745; font-weight: bold;">‚ñ†</span> Simpanan</span>
                                <span><span style="color:var(--primary); font-weight: bold;">‚ñ†</span> Variabel</span>
                            </div>
                        </div>
                        <div id="budgetProgress" style="margin-top:14px">
                            <div class="muted">Estimasi Dana Variabel Terpakai:</div>
                            <div class="progress-bar-container"><div id="variableProgress" class="progress-bar" style="width:0%"></div></div>
                            <div class="muted" style="margin-top:4px"><span id="spentRatio">0%</span> dari Anggaran Variabel</div>
                        </div>
                    </div>

                    <div style="margin-top:16px" class="card">
                        <h3>Catatan Pengeluaran</h3>
                        <div class="row" style="gap:6px;margin-top:8px">
                            <input id="expName" placeholder="Nama pengeluaran, contoh: transport" />
                            <input id="expAmt" type="number" placeholder="Rp" />
                            <button id="addExp" class="btn-primary">Tambah</button>
                        </div>
                        <ul id="expList" style="margin-top:10px;list-style:none;padding:0"></ul>
                    </div>
                </div>

                <aside>
                    <div class="card">
                        <h3>Ringkasan</h3>
                        <div class="muted" id="summaryText">Belum ada perhitungan.</div>
                    </div>

                    <div class="card" style="margin-top:12px">
                        <h3>Tips Cepat</h3>
                        <ul class="muted" style="padding-left:18px;margin:8px 0">
                            <li>Mulai catat semua pengeluaran kecil selama 1 minggu.</li>
                            <li>Prioritaskan dana darurat minimal 3 bulan pengeluaran tetap.</li>
                            <li>Pakai target simpanan otomatis (20% sebagai awalan).</li>
                        </ul>
                    </div>
                </aside>

            </div>
        </section>

        <section id="career" class="card" style="display:none;margin-top:12px">
            <div class="grid">
                <div>
                    <h2>Career Planner & Resume Builder (Link and Match Skill)</h2>
                    <p class="muted">Rencanakan langkah kariermu, buat resume cepat, dan atur jalur skill growth.</p>

                    <div class="card">
                        <h3>Career Planner</h3>
                        <label>Posisi Saat Ini</label>
                        <input id="currentPos" placeholder="Contoh: Junior Web Developer" />
                        <label style="margin-top:8px">Target Posisi (1-3 tahun)</label>
                        <input id="targetPos" placeholder="Contoh: Frontend Engineer / Team Lead" />
                        <label style="margin-top:8px">Langkah / Action</label>
                        <textarea id="careerActions" rows="3" placeholder="Langkah: kursus React, proyek portofolio, ikut komunitas"></textarea>
                        <div style="margin-top:8px; display:flex; gap:8px;">
                            <button id="savePlan" class="btn-primary">Simpan Rencana</button>
                            <button id="setReminder" class="btn-ghost" title="Set pengingat di browser">Set Pengingat üîî</button>
                        </div>
                        <div id="planPreview" style="margin-top:12px"></div>
                    </div>

                    <a href="https://inovasilentera.com/" target="_blank" class="new-link-btn">
                        Cari Tahu Inovasi Lentera &rarr;
                    </a>
                    
                    <div class="card" style="margin-top:12px">
                        <h3>AI Resume & Portfolio (Generator Template)</h3>
                        <label>Nama Lengkap</label>
                        <input id="fullName" placeholder="Nama" />
                        <label style="margin-top:8px">Ringkasan (Profile)</label>
                        <textarea id="profile" rows="3" placeholder="Tuliskan 2-3 kalimat tentang dirimu"></textarea>
                        <label style="margin-top:8px">Pengalaman Singkat</label>
                        <textarea id="xp" rows="3" placeholder="Jelaskan pengalaman atau proyek penting"></textarea>
                        <div style="margin-top:8px;display:flex;gap:8px"><button id="genResume" class="btn-primary">Buat Resume</button><button id="downloadResume" class="btn-ghost">Download (txt)</button></div>

                        <div style="margin-top:12px">
                            <div class="resume-preview" id="resumePreview">Resume kosong ‚Äî isi form di atas lalu klik "Buat Resume".</div>
                        </div>
                    </div>

                </div>

                <aside>
                    <div class="card">
                        <h3>Skill Growth Path (Link and Match Skill + Data Industri)</h3>
                        <label>Pilih Skill</label>
                        <select id="skillSelect">
                            <option value="web">Web Development</option>
                            <option value="data">Data Science</option>
                            <option value="uiux">UI/UX Design</option>
                        </select>
                        <div style="margin-top:8px"><button id="showPath" class="btn-primary">Tampilkan Jalur</button></div>
                        <div id="pathArea" style="margin-top:10px" class="muted"></div>
                    </div>

                    <div class="card" style="margin-top:12px">
                        <h3>Portofolio</h3>
                        <label>Upload Gambar Proyek</label>
                        <input id="projImg" type="file" accept="image/*" />
                        <div id="imgPreview" style="margin-top:8px"></div>
                    </div>
                </aside>

            </div>
        </section>

        <section id="mental" class="card" style="display:none;margin-top:12px">
            <div class="grid">
                <div>
                    <h2>Community Support</h2>
                    <p class="muted">Tempat saling dukung ‚Äî jalur aman untuk berbagi cerita singkat. Pesan disimpan di browser (lokal).</p>

                    <div class="card">
                        
                        <div id="replyingTo" class="muted" style="padding: 8px; margin-top: 12px; border-left: 3px solid var(--accent); background: white; border-radius: 4px; display: none;">
                            Membalas: <span id="replyingText"></span>
                            <button id="cancelReply" class="btn-ghost" style="padding: 2px 6px; margin-left: 8px; font-size: 11px;">Batal</button>
                        </div>
                        <label style="margin-top:12px">Nama</label>
                        <input id="cmName" placeholder="Nama (bisa anonim)" />
                        <label style="margin-top:8px">Pesan / Curhat singkat</label>
                        <textarea id="cmMsg" rows="3" placeholder="Tetap sopan dan jangan bagikan data sensitif"></textarea>
                        
                        <div style="margin-top:8px;display:flex;gap:8px">
                            <input type="hidden" id="cmMood" value="üòä"> 
                            <button id="postMsg" class="btn-primary">Kirim</button>
                            <button id="clearMsgs" class="btn-ghost">Bersihkan</button>
                        </div>

                        <div class="messages" id="msgList" style="margin-top:12px"></div>
                    </div>

                </div>

                <aside>
                    <div class="card">
                        <h3>Resource Ringkas</h3>
                        <ul class="muted" style="padding-left:18px;margin:8px 0">
                            <li>Jika darurat: hubungi layanan kesehatan terdekat.</li>
                            <li>Latihan pernapasan 4-4-4 selama 2 menit untuk menurunkan kecemasan.</li>
                            <li>Gabung komunitas lokal untuk dukungan berkala.</li>
                        </ul>
                    </div>

                    <div class="card" style="margin-top:12px">
                        <h3>Privasi</h3>
                        <div class="muted">Semua pesan tersimpan di perangkatmu dan tidak dikirim ke server mana pun. Jangan bagikan data sensitif.</div>
                    </div>
                </aside>

            </div>
        </section>

        <footer>Vinix 7 Asisten ‚ù§Ô∏è ¬∑ Disusun oleh Kelompok 30</footer>
    </div>

    <script>
        // Tab logic
        document.querySelectorAll('.tab').forEach(btn => btn.addEventListener('click', ()=>{
            document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'))
            btn.classList.add('active')
            const t = btn.dataset.tab
            document.querySelectorAll('section').forEach(s => s.style.display = 'none')
            document.getElementById(t).style.display = ''

            // Panggil loadMsgs() jika tab Mental Zone dibuka
            if (t === 'mental') {
                loadMsgs();
            }
        }))

        // Finance logic variables
        const income = document.getElementById('income')
        const fixed = document.getElementById('fixed')
        const savePct = document.getElementById('savePct')
        const calcBtn = document.getElementById('calcBudget')
        const budgetResult = document.getElementById('budgetResult')
        const summaryText = document.getElementById('summaryText')
        const variableProgress = document.getElementById('variableProgress')
        const spentRatio = document.getElementById('spentRatio')
        let variableBudget = 0 
        let exps = JSON.parse(localStorage.getItem('vinixExps')) || []; // Load dari local storage

        function formatRp(n){return 'Rp ' + Number(n).toLocaleString('id-ID')}

        function updateFinanceSummary() {
            const inc = Number(income.value)||0
            const fix = Number(fixed.value)||0
            const pct = Number(savePct.value)||0
            const save = Math.round(inc * (pct/100))
            const totalExpensed = exps.reduce((sum, e) => sum + e.amt, 0); 
            const remaining = inc - fix - save
            
            // Update Anggaran Variabel Global
            variableBudget = remaining > 0 ? remaining : 0; 

            budgetResult.innerHTML = `<div class="muted">Saran:</div>
                <div style="margin-top:8px">Simpanan: <strong>${formatRp(save)}</strong> (${pct}%)</div>
                <div>Pengeluaran Tetap: <strong>${formatRp(fix)}</strong></div>
                <div>Anggaran Variabel tersisa: <strong>${formatRp(variableBudget)}</strong></div>`
            summaryText.textContent = `Simpanan ${formatRp(save)} ‚Äî Variabel ${formatRp(variableBudget)}`
            
            // --- LOGIC PROGRESS BAR FIXED START ---
            let usagePct = 0
            let displayRatioText = '';
            
            if (variableBudget > 0) {
                // Hitung persentase penggunaan dari budget yang tersedia
                usagePct = (totalExpensed / variableBudget) * 100;

                if (usagePct > 100) {
                    const overAmount = totalExpensed - variableBudget;
                    variableProgress.style.width = `100%`;
                    variableProgress.style.backgroundColor = '#dc3545'; 
                    displayRatioText = `<strong style="color: #dc3545;">OVER BUDGET: ${formatRp(overAmount)}</strong> (${formatRp(totalExpensed)} terpakai dari ${formatRp(variableBudget)})`;

                } else {
                    const displayPct = Math.round(usagePct);
                    variableProgress.style.width = `${displayPct}%`;
                    variableProgress.style.backgroundColor = 'var(--accent)'; 
                    displayRatioText = `${displayPct}% dari ${formatRp(variableBudget)}`;
                }
            } else if (totalExpensed > 0) {
                 variableProgress.style.width = `100%`;
                 variableProgress.style.backgroundColor = '#dc3545';
                 displayRatioText = `<strong style="color: #dc3545;">WARNING: ${formatRp(totalExpensed)} terpakai. Budget Variabel NOL.</strong>`;

            } else {
                 variableProgress.style.width = `0%`;
                 variableProgress.style.backgroundColor = 'var(--accent)';
                 displayRatioText = `0% dari ${formatRp(variableBudget)}`;
            }

            spentRatio.innerHTML = displayRatioText;
            // --- LOGIC PROGRESS BAR FIXED END ---

            // --- LOGIC GRAFIK DISTRIBUSI BARU START ---
            const total = inc; 
            const fixedBar = document.getElementById('fixedBar');
            const saveBar = document.getElementById('saveBar');
            const variableBar = document.getElementById('variableBar');
            
            if (total > 0) {
                const fixedPct = (fix / total) * 100;
                const savePctDisplay = (save / total) * 100;
                const variablePct = (variableBudget / total) * 100;

                fixedBar.style.width = `${fixedPct}%`;
                fixedBar.textContent = fixedPct >= 5 ? `${Math.round(fixedPct)}%` : ''; 
                
                saveBar.style.width = `${savePctDisplay}%`;
                saveBar.textContent = savePctDisplay >= 5 ? `${Math.round(savePctDisplay)}%` : '';

                variableBar.style.width = `${variablePct}%`;
                variableBar.textContent = variablePct >= 5 ? `${Math.round(variablePct)}%` : '';

            } else {
                // Reset jika income 0
                fixedBar.style.width = '0%';
                saveBar.style.width = '0%';
                variableBar.style.width = '0%';
                fixedBar.textContent = '';
                saveBar.textContent = '';
                variableBar.textContent = '';
            }
            // --- LOGIC GRAFIK DISTRIBUSI BARU END ---
        }

        calcBtn.addEventListener('click', updateFinanceSummary)

        document.getElementById('resetBudget').addEventListener('click', ()=>{
            income.value = 5000000; fixed.value=2000000; savePct.value=20; budgetResult.innerHTML=''; summaryText.textContent='Belum ada perhitungan.';
            variableBudget = 0; exps = []; 
            localStorage.removeItem('vinixExps'); // Hapus dari local storage
            renderExps(); updateFinanceSummary();
        })
        
        // Panggil saat awal dimuat untuk inisiasi
        updateFinanceSummary(); 

        // Expense list
        const expList = document.getElementById('expList')
        const expName = document.getElementById('expName')
        const expAmt = document.getElementById('expAmt')
        const addExp = document.getElementById('addExp')
        
        function saveExps() {
            localStorage.setItem('vinixExps', JSON.stringify(exps));
        }

        function renderExps(){
            expList.innerHTML = ''
            exps.forEach((e,i)=>{
                const li = document.createElement('li')
                li.style.padding='8px'
                li.style.display='flex'
                li.style.justifyContent='space-between'
                li.className='muted'
                li.innerHTML = `<div>${e.name}</div><div>${formatRp(e.amt)} <button style="margin-left:8px" data-i="${i}" class="btn-ghost">hapus</button></div>`
                expList.appendChild(li)
            })
            // Re-attach event listeners after rendering
            expList.querySelectorAll('button').forEach(b=>b.addEventListener('click', (ev)=>{
                const i = ev.target.dataset.i
                exps.splice(i,1); 
                saveExps(); // Simpan setelah menghapus
                renderExps(); 
                updateFinanceSummary(); 
            }))
        }
        addExp.addEventListener('click', ()=>{
            const name = expName.value.trim(); const amt = Number(expAmt.value)||0
            if(!name || amt<=0) return alert('Isi nama dan jumlah pengeluaran yang valid')
            exps.push({name,amt}); expName.value=''; expAmt.value=''; 
            saveExps(); // Simpan setelah menambah
            renderExps(); 
            updateFinanceSummary(); 
        })
        // Panggil saat awal dimuat
        renderExps();

        // Career planner
        document.getElementById('savePlan').addEventListener('click', ()=>{
            const cur = document.getElementById('currentPos').value
            const tar = document.getElementById('targetPos').value
            const act = document.getElementById('careerActions').value
            const preview = document.getElementById('planPreview')
            preview.innerHTML = `<div class="muted"><strong>Posisi saat ini:</strong> ${cur||'-'}<br><strong>Target:</strong> ${tar||'-'}<br><strong>Action:</strong> ${act||'-'}</div>`
        })

        // Fitur Notifikasi/Pengingat Sederhana (dengan nama Vinix)
        document.getElementById('setReminder').addEventListener('click', ()=>{
            const targetPos = document.getElementById('targetPos').value
            const actions = document.getElementById('careerActions').value
            
            if (targetPos || actions) {
                // Notifikasi suara akan membutuhkan file 'notification.mp3' yang harus ada di direktori
                // const audio = new Audio('notification.mp3'); 
                // audio.play().catch(error => {
                //     console.log('Autoplay suara diblokir:', error);
                // });

                const message = `üîî VINIX ASISTEN MENGINGATKAN:\n\nTarget karir Anda: ${targetPos||'Belum ditentukan'}.\nAksi: ${actions||'Belum ada action'}.\n\nLanjutkan perencanaan di Career Zone!`
                alert(message)
            } else {
                 alert('VINIX ASISTEN: Silakan isi "Target Posisi" atau "Langkah / Action" di Career Planner terlebih dahulu!')
            }
        })

        // Resume generator (simple template)
        const resumePreview = document.getElementById('resumePreview')
        let lastResumeText = ''
        document.getElementById('genResume').addEventListener('click', ()=>{
            const name = document.getElementById('fullName').value || 'Nama Kamu'
            const profile = document.getElementById('profile').value || 'Ringkasan singkat tentang kamu.'
            const xp = document.getElementById('xp').value || 'Pengalaman / proyek singkat.'
            const txt = `Nama: ${name}\n\nProfil:\n${profile}\n\nPengalaman:\n${xp}\n\nSkills:\n- Bahasa Pemrograman\n- Tools & Framework\n\nPortofolio: cantumkan link atau screenshot proyek.`
            resumePreview.textContent = txt.replace(/\n/g,'\n')
            lastResumeText = txt
        })
        document.getElementById('downloadResume').addEventListener('click', ()=>{
            if(!lastResumeText) return alert('Buat resume terlebih dahulu')
            const blob = new Blob([lastResumeText],{type:'text/plain'})
            const url = URL.createObjectURL(blob)
            const a = document.createElement('a'); a.href=url; a.download='resume.txt'; a.click(); URL.revokeObjectURL(url)
        })

        // Skill Growth Path (Link and Match + Data Industri)
        document.getElementById('showPath').addEventListener('click', ()=>{
            const s = document.getElementById('skillSelect').value
            const area = document.getElementById('pathArea')
            const paths = {
                web:{
                    path:`1. HTML & CSS ‚Üí 2. JavaScript dasar ‚Üí 3. Framework (React/Vue) ‚Üí 4. Proyek portofolio ‚Üí 5. System Design & Testing`,
                    data:`Kebutuhan Pasar: Tumbuh Cepat (+18%) di sektor startup & e-commerce. Prospek: Frontend/Backend Developer. Skill Paling Dicari: React/Next.js.`
                },
                data:{
                    path:`1. Statistik dasar ‚Üí 2. Python & Pandas ‚Üí 3. Machine Learning dasar ‚Üí 4. Project Kaggle ‚Üí 5. Deploy Model`,
                    data:`Kebutuhan Pasar: Sangat Tinggi (+25%) di bidang Finance dan Retail untuk analisis prediktif. Prospek: Data Analyst/Scientist. Skill Paling Dicari: SQL, Python, Tableau.`
                },
                uiux:{
                    path:`1. Dasar desain visual ‚Üí 2. Figma & prototyping ‚Üí 3. User research ‚Üí 4. Usability testing ‚Üí 5. Case study portofolio`,
                    data:`Kebutuhan Pasar: Stabil (+10%), dicari perusahaan yang fokus pada peningkatan user experience produk digital. Prospek: UI/UX Designer/Researcher. Skill Paling Dicari: Figma, User Research.`
                }
            }
            
            const selected = paths[s]
            // Memastikan area pathArea diisi dengan format baru (Jalur dan Data Industri)
            area.innerHTML = `<strong>Jalur Belajar:</strong> ${selected.path}`
            area.innerHTML += `<div class="skill-data"><strong>Data Industri:</strong> ${selected.data}</div>`
        })

        // Image preview for portfolio
        document.getElementById('projImg').addEventListener('change', (e)=>{
            const f = e.target.files[0]
            const p = document.getElementById('imgPreview')
            p.innerHTML = ''
            if(!f) return
            const img = document.createElement('img')
            img.style.maxWidth='100%'; img.style.borderRadius='8px'
            img.src = URL.createObjectURL(f)
            p.appendChild(img)
        })

        // Community messages (localStorage) & Sticker Logic
        let currentMood = 'üòä'; // Default mood
        let replyingIndex = -1; 
        
        // DAFTAR STIKER BARU
        const allStickers = [
            'üëç', '‚ù§Ô∏è', 'üî•', 'üôè', 'üíØ', 'ü§£', 'üò≠', 'ü§Ø', 'ü•≥', 'üòé', 
            'üëè', 'üò¢', 'ü§®', 'ü§î', 'üôå', 'üéâ', 'üåü', 'üòá', 'üò¥', 'üò•',
            'üò¨', 'üòà', 'üëÄ', 'üí°', 'üí¨', 'üí™', 'üôè', 'ü§ë', 'ü§´', 'üò±',
        ];
        
        const msgList = document.getElementById('msgList')
        const replyingTo = document.getElementById('replyingTo')
        const replyingText = document.getElementById('replyingText')
        const cancelReply = document.getElementById('cancelReply')

        function escapeHtml(s){return String(s).replace(/[&<>"]+/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]||c))}
        
        // FUNGSI BARU: Menampilkan/Menyembunyikan Modal Stiker
        function toggleStickerModal(msgIndex, buttonElement) {
            // Hapus modal yang mungkin sudah ada
            document.querySelectorAll('.sticker-modal').forEach(m => m.remove());

            // Jika modal baru akan dibuka
            if (buttonElement.dataset.modalOpen !== 'true') {
                const modal = document.createElement('div');
                modal.className = 'sticker-modal';
                modal.dataset.msgIndex = msgIndex;
                
                allStickers.forEach(sticker => {
                    const stickerBtn = document.createElement('span');
                    stickerBtn.className = 'modal-sticker';
                    stickerBtn.textContent = sticker;
                    stickerBtn.addEventListener('click', () => {
                        addReaction(msgIndex, sticker);
                        modal.remove(); // Tutup modal setelah memilih
                    });
                    modal.appendChild(stickerBtn);
                });

                // Tentukan posisi modal
                // Memposisikan modal di samping tombol pemicu
                buttonElement.parentElement.style.position = 'relative'; // Pastikan container pesan memiliki posisi relatif
                buttonElement.parentNode.insertBefore(modal, buttonElement.nextSibling);

                // Set status modal
                document.querySelectorAll('.reaction-trigger-btn').forEach(b => b.dataset.modalOpen = 'false');
                buttonElement.dataset.modalOpen = 'true';
            } else {
                buttonElement.dataset.modalOpen = 'false';
            }
        }

        // FUNGSI BARU: Menambahkan Reaksi
        function addReaction(index, sticker) {
            let messages = JSON.parse(localStorage.getItem('vinixMsgs') || '[]');
            
            if (index >= 0 && index < messages.length) {
                if (!messages[index].reactions) {
                    messages[index].reactions = {};
                }
                
                // Tambahkan hitungan untuk stiker ini
                messages[index].reactions[sticker] = (messages[index].reactions[sticker] || 0) + 1;
                
                localStorage.setItem('vinixMsgs', JSON.stringify(messages));
                loadMsgs(); // Render ulang
            }
        }
        
        // FUNGSI BARU: Hapus Reaksi (untuk simplifikasi, kita hanya biarkan hitungan naik)
        /* function removeReaction(index, sticker) {} */


        function loadMsgs(){
            let messages = JSON.parse(localStorage.getItem('vinixMsgs') || '[]');
            msgList.innerHTML = ''

            // Pastikan pesan yang terbaru muncul di bawah
            messages.slice().reverse().forEach((msg, originalIndex) => {
                const i = messages.length - 1 - originalIndex; // Hitung ulang index asli (untuk tombol)
                
                const div = document.createElement('div')
                div.className = 'msg'
                
                // Jika ada balasan, tampilkan indikator
                let replyHtml = '';
                if (msg.replyTo) {
                    replyHtml = `<div class="msg-reply-indicator muted">Membalas: ${escapeHtml(msg.replyTo)}</div>`;
                }
                
                // Render Reactions
                let reactionsHtml = '';
                if (msg.reactions && Object.keys(msg.reactions).length > 0) {
                    reactionsHtml = `<div class="reactions-display">`;
                    for (const sticker in msg.reactions) {
                        const count = msg.reactions[sticker];
                        if (count > 0) {
                            reactionsHtml += `<span class="reaction-count" data-index="${i}" data-sticker="${sticker}">${sticker} ${count}</span>`;
                        }
                    }
                    reactionsHtml += `</div>`;
                }

                div.innerHTML = `
                    ${replyHtml}
                    <div style="font-weight:600">${escapeHtml(msg.name)}</div>
                    <div class="muted" style="margin-bottom:8px">${new Date(msg.date).toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit', day:'2-digit', month:'short'})}</div>
                    <div style="white-space: pre-wrap; margin-bottom: 8px;">${escapeHtml(msg.message)}</div>
                    <div style="display:flex; justify-content:flex-end; gap:8px;">
                        <button class="btn-ghost reply-btn" data-index="${i}">Balas</button>
                        <button class="btn-delete" data-index="${i}">Hapus</button>
                        <button class="reaction-trigger-btn" data-index="${i}">
                            üòä
                        </button>
                    </div>
                    ${reactionsHtml}
                `
                msgList.appendChild(div)
            })

            // Attach event listeners for Reply, Delete, and Reaction Trigger
            msgList.querySelectorAll('.reply-btn').forEach(btn => btn.addEventListener('click', (e) => {
                const index = e.target.dataset.index;
                const messages = JSON.parse(localStorage.getItem('vinixMsgs') || '[]');
                if (index !== undefined && messages[index]) {
                    replyingIndex = parseInt(index);
                    replyingText.textContent = messages[index].message.substring(0, 40) + '...';
                    replyingTo.style.display = 'block';
                    document.getElementById('cmMsg').focus();
                }
            }));
            
            msgList.querySelectorAll('.btn-delete').forEach(btn => btn.addEventListener('click', (e) => {
                const index = e.target.dataset.index;
                if (confirm('Yakin ingin menghapus pesan ini?')) {
                    deleteMsg(parseInt(index));
                }
            }));

            msgList.querySelectorAll('.reaction-trigger-btn').forEach(btn => btn.addEventListener('click', (e) => {
                const index = e.currentTarget.dataset.index;
                // e.stopPropagation(); // Mencegah klik menyebar ke elemen lain
                toggleStickerModal(parseInt(index), e.currentTarget);
            }));

             // Attach event listeners for reaction counts (to add reaction on click)
            msgList.querySelectorAll('.reaction-count').forEach(span => span.addEventListener('click', (e) => {
                const index = e.currentTarget.dataset.index;
                const sticker = e.currentTarget.dataset.sticker;
                addReaction(parseInt(index), sticker);
            }));

            // Auto-scroll to bottom of messages
            msgList.scrollTop = msgList.scrollHeight;
        }

        cancelReply.addEventListener('click', () => {
            replyingIndex = -1;
            replyingTo.style.display = 'none';
        });

        function deleteMsg(index) {
            let messages = JSON.parse(localStorage.getItem('vinixMsgs') || '[]');
            if (index >= 0 && index < messages.length) {
                messages.splice(index, 1);
                localStorage.setItem('vinixMsgs', JSON.stringify(messages));
                loadMsgs();
                // Reset reply state if deleted message was being replied to
                if (replyingIndex === index) {
                    cancelReply.click();
                }
            }
        }

        document.getElementById('postMsg').addEventListener('click', ()=>{
            const name = document.getElementById('cmName').value.trim() || 'Anonim'
            const message = document.getElementById('cmMsg').value.trim()
            
            if(!message) return alert('Pesan tidak boleh kosong')

            let messages = JSON.parse(localStorage.getItem('vinixMsgs') || '[]');
            
            let replyToText = null;
            if (replyingIndex !== -1) {
                 const originalMsg = messages[replyingIndex];
                 replyToText = `${originalMsg.name}: ${originalMsg.message.substring(0, 40)}${originalMsg.message.length > 40 ? '...' : ''}`;
            }

            messages.push({
                name,
                message,
                date: new Date().toISOString(),
                replyTo: replyToText, // Simpan teks balasan
                reactions: {} // Objek untuk menyimpan reaksi
            })

            localStorage.setItem('vinixMsgs', JSON.stringify(messages));
            document.getElementById('cmMsg').value = ''
            cancelReply.click(); // Reset state balasan
            loadMsgs();
        })

        document.getElementById('clearMsgs').addEventListener('click', ()=>{
            if(confirm('Yakin ingin menghapus semua pesan? Ini tidak bisa diurungkan.')){
                localStorage.removeItem('vinixMsgs');
                loadMsgs();
            }
        })
    </script>
</body>
</html>